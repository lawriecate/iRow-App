<!DOCTYPE html> 
<html> 
	<head> 
	<title>iRow Athlete App</title> 
	
	<meta name="viewport" content="width=device-width, initial-scale=1"> 

	<link rel="stylesheet" href="jquery.mobile-1.1.0.min.css" />
	<script src="jquery-1.7.1.min.js"></script>
	<script src="jquery.mobile-1.1.0.min.js"></script>
	<style type="text/css">
	#splash {
		background-image: url('splash.jpg');
		background-size: cover;
    background-repeat: no-repeat;
	}
#splash h1 {
		font-size: 7em;
		margin: 0;
}
	#splash h1,h2,h3 {
		color: #fff;
		 text-shadow: 1px 0px 20px #000;
		 text-stroke:1px #000 ;
		text-align: center;
	}

	#splash p,.protomsg {
		background: rgba(0,0,0,0.5);
		padding: 4px;
		border-radius: 4px;
		text-shadow:none;
		color: #fff;
	}
	</style>
</head> 

<body> 
<!-- Start of first page -->
<div data-role="page" id="splash">

	<!--<div data-role="header">
		<h1>Welcome</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<h1>iRow</h1>
		<h3>Prototype</h3>
		<h2>Welcome</h2>
		<p>This is the iRow prototype app, for testing purposes only.</p>		
			
		<p><a href="#login" data-transition="slideup">Click here to start</a></p>	

	</div><!-- /content -->

	<!--<div data-role="footer">
		<h4>LGC</h4>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of login page -->
<div data-role="page" id="login">

	<div data-role="header">
		<h1>Login</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<form id="loginForm" action="http://beta.irow.co.uk/login/?format=json" method="post">

			<div data-role="fieldcontain">
	         <label for="email">Email:</label>
	         <input type="email" name="email" id="loginEmail" value=""  />
			</div>

			<div data-role="fieldcontain">
	         <label for="password">Password:</label>
	         <input type="password" name="password" id="loginPassword" value=""  />
			</div>
			
			<div class="ui-body ">
					<div class=""><button type="submit" data-theme="a">Sign In</button></div>
			</div>
	</form>
		<p>View internal page called <a href="#logbook" data-transition="pop">logbook</a></p>		
		<p>View internal page called <a href="#add" data-transition="slide">register</a></p>	
	</div><!-- /content -->

	<!--<div data-role="footer">
		<h4>LGC</h4>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of sign up page -->
<div data-role="page" id="register">

	<div data-role="header">
		<h1>Sign Up</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>Register Form Goes Here.  For now please register on at <a href="http://beta.irow.co.uk/register" target="_blank">beta.irow.co.uk/register</a></p>	
		<p>View internal page called <a href="#logbook" data-transition="pop">logbook</a></p>		
	</div><!-- /content -->

	<div data-role="footer" >
		<h4></h4>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of login page -->
<div data-role="page" id="logbook">

	<div data-role="header">
		<h1>Logbook</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<ul id="logbookList" data-role="listview" data-theme="d" data-divider-theme="d">
		
		</ul>
		<p>View internal page called <a href="#add" data-transition="slideup">ADD Activity</a></p>		
		<p>View internal page called <a href="#settings" data-transition="flip">settings</a></p>	
	</div><!-- /content -->

	<div data-role="footer" class="ui-bar" data-position="fixed">
		<a href="#add" data-role="button" data-icon="plus" data-transition="slideup">Add</a>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of log page -->
<div data-role="page" id="add">

	<div data-role="header">
		<h1>Log Activity</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<form action="#" method="get">
			<div data-role="fieldcontain">
			    <fieldset data-role="controlgroup" >
			     	<legend>Type:</legend>
			         	<input type="radio" name="type" id="radio-choice-a" value="1" checked="checked" />
			         	<label for="radio-choice-a">Erg</label>
			         	<input type="radio" name="type" id="radio-choice-b" value="2" />
			         	<label for="radio-choice-b">Water</label>
			         	<input type="radio" name="type" id="radio-choice-c" value="3" />
			         	<label for="radio-choice-c">Indoor</label>
			         	<input type="radio" name="type" id="radio-choice-d" value="4" />
			         	<label for="radio-choice-d">Outdoor</label>
			    </fieldset>

			</div>
			<div data-role="fieldcontain">
			    <fieldset data-role="controlgroup" data-type="horizontal">
			     	<legend>Type:</legend>
			         	<input type="radio" name="radio-choice-b" id="radio-choice-c" value="on" checked="checked" />
			         	<label for="radio-choice-c">Timed</label>
			         	<input type="radio" name="radio-choice-b" id="radio-choice-d" value="off" />
			         	<label for="radio-choice-d">Distance</label>

			    </fieldset>

			</div>


			<div data-role="fieldcontain">
	         <label for="name">When:</label>
	         <input type="date" name="name" id="name" value=""  />
			</div>

			<div data-role="fieldcontain">
			<label for="textarea">Notes:</label>
			<textarea cols="40" rows="8" name="textarea" id="textarea"></textarea>
			</div>

			


		<div class="ui-body ui-body-b">
		<fieldset class="ui-grid-a">
				<div class="ui-block-a"><button type="submit" data-theme="d">Cancel</button></div>
				<div class="ui-block-b"><button type="submit" data-theme="a">Submit</button></div>
	    </fieldset>
		</div>
	</form>
		<p>View internal page called <a href="#logbook" data-transition="slidedown">logbook</a></p>		
	</div><!-- /content -->

	<div data-role="footer" class="ui-bar"  data-position="fixed">
		<a href="#logbook" data-role="button" data-icon="plus" data-transition="slidedown">Finish &amp; Save</a>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of login page -->
<div data-role="page" id="settings">

	<div data-role="header">
		<h1>Settings</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>Settings Form Goes Here</p>	
		<p>View internal page called <a href="#logbook" data-transition="flip">logbook</a></p>		
		
		<a href="#logout" data-role="button">Sign Out</a>
	
	</div><!-- /content -->

	<div data-role="footer"  class="ui-bar" data-position="fixed">
		<a href="#logbook" data-role="button" data-icon="plus" data-transition="flip">Save</a>
	</div><!-- /footer -->
</div><!-- /page -->

<!-- Start of login page -->
<div data-role="page" id="logout">

	
	<div data-role="content">	
		<h1>Bye bye!</h1>
	</div><!-- /content -->

	
</div><!-- /page -->
<script type="text/javascript" src="sha1.js"></script>
<script type="text/javascript">
$.support.cors = true;
var apikey = "XZ8f7a50d6UrXegrqAXlNMhHD91O81z2";
	$( document ).bind( "mobileinit", function() {
	    $.mobile.allowCrossDomainPages = true;

	});
	$(document).delegate("#splash","pageinit",function() {
		console.log("Splash loaded");
		logged_in = localStorage.getItem("logged_in");
		
		if(logged_in == "true") {
			$.mobile.changePage( "#logbook");
		}

	});
	$( document ).delegate("#login", "pageinit", function() {



	 	$("#loginForm").submit(function() {
	 		event.preventDefault();
	 		$.post("http://beta.irow.co.uk/apilogin/?api_key="+apikey, 
	 			{ email: $("#loginEmail").val(), password: $("#loginPassword").val() })
	 			.done( function(data) {
	 			//alert('Yey,we broke in the keys are ' + data.k1 + ' and ' + data.k2);
	 			console.log("user is now logged in!");
	        	localStorage.setItem("token_private", data.k2);
	      		localStorage.setItem("token_public", data.k1);
	      		localStorage.setItem("logged_in",true);
	      		$.mobile.changePage( "#logbook");
	 		}).error(function(jqXHR, textStatus, errorThrown) {
	 			alert('You couldn\'t be logged in');
	 			console.log(textStatus);
	 		});
	 	});
	});

	function getAuthorizedUrl(plainUrl) {
		var timestamp = Math.round(+new Date()/1000);
		newUrl = plainUrl + "?api_key="+apikey+"&key="+localStorage.getItem("token_public")+"&timestamp="+timestamp+"&hash="+Sha1.hash(timestamp+localStorage.getItem("token_private"));
		return newUrl;
	}

	$( document ).delegate("#logbook", "pagebeforecreate", function() {
		logbookUrl = (getAuthorizedUrl("http://beta.irow.co.uk/api/logbook_feed/"));
		console.log(logbookUrl);
		$.get(logbookUrl,function(logbookData) {
			$.each(logbookData,function(key,object) {
				var li = '<li data-role="list-divider">'+object.date
				+ '<span class="ui-li-count">2</span></li>' 
+ '			<li><a href="index.html">'				
+'					<h3>'+object.label+'</h3>'
+ '					<p><strong>'+object.split+'</strong></p>'
+ '					<p></p>'
+ '					<p class="ui-li-aside"><strong>6:24</strong>PM</p>'				
+	'		</a></li>';
				$("#logbookList").append(li);
			});
			$( "#logbookList" ).listview( "refresh" );
		});
	});

	$( document ).delegate("#logout", "pagebeforecreate", function() {
			localStorage.setItem("token_private",null);
			localStorage.setItem("token_public",null);
			localStorage.setItem("logged_in",false);
		$.mobile.changePage( "#splash");
		
	});
</script>
</body>
</html>